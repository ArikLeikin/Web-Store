<!DOCTYPE html>
<html>
  <head>
    <title>Games For All</title>
    <link rel="icon" type="image/x-icon" href="../images/favicon.png" />
    <link rel="stylesheet" href="../css/index.css" />
    <link rel="stylesheet" type="text/css" href="../css/products.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <script src="../js/index.js"></script>
    <script src="../js/products.js"></script>
  </head>
  <body>
    <header class="header" role="banner">
      <div class="container">
        <nav class="navUser">
          <ul class="navUser-section">
            <li class="item__account" id="item__account">
              <a aria-label="Account" href=""
                ><img
                  src="../images/white-icons/account-icon.png"
                  alt="account"
                  width="30"
                />
              </a>
            </li>
            <li class="item__wishlist">
              <a aria-label="Wishlist" href="">
                <img
                  src="../images/white-icons/wishlist-icon.png"
                  alt="Cart"
                  width="30"
                />
              </a>
            </li>
            <li class="item__cart">
              <a href="../html/cart.html" aria-label="Cart">
                <img
                  src="../images/white-icons/cart-icon.png"
                  alt="Cart"
                  width="30"
                />
              </a>
            </li>
          </ul>
        </nav>

        <div class="header-logo">
          <a href="#" data-instantload='{"page":"home"}'>
            <div class="header-logo-image-container">
              <img
                class="header-logo-image"
                src="../images/logo.png"
                width="180"
                height="auto"
              />
            </div>
          </a>
        </div>

        <div class="quickSearch">
          <form class="form">
            <div class="form-container">
              <input
                class="form-input"
                data-search-quick
                name="search_query"
                id="search_query"
                data-error-message="Search field cannot be empty."
                placeholder="Search the store"
                autocomplete="off"
              />
              <button
                type="submit"
                class="button search-button"
                id="searchButton"
              >
                <img
                  src="../images/white-icons/search-icon.png"
                  alt="Search"
                  width="25"
                  height="auto"
                />
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Start Navigation Bar -->
      <nav class="navbar">
        <ul class="menu">
          <li>
            <a class="hasDropdown" href="#"
              >Categories <i class="fa fa-angle-down"></i
            ></a>

            <ul class="nav_container">
              <div class="container__list">
                <div class="container__listItem">
                  <div class="container__listItem_title" >
                    <a href="">Board Games</a>
                  </div>                  
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">Science</div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">Games</div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">Riding Toys</div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">Puzzles</div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">Music&Karaoke</div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">Books</div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">Lego</div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">Dolls</div>
                </div>
                <div class="container__listItem"></div>
                <div class="container__listItem"></div>

                <div class="container__listItem">
                  <div class="container__listItem_title bold no-underline">
                    $10 & Below
                  </div>
                </div>
              </div>
            </ul>
          </li>
          <li>
            <a class="hasDropdown" href="#"
              >Ages<i class="fa fa-angle-down"></i
            ></a>
            <ul class="nav_container">
              <div class="container__list">
                <div class="container__listItem">
                  <div class="container__listItem_title">0-12 MONTHS</div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">12-24 MONTHS</div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">2-4 YEARS</div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">5-7 YEARS</div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">8-99 YEARS</div>
                </div>
              </div>
            </ul>
          </li>
          <li>
            <a href="#">Outdoor</a>
          </li>
          <li>
            <a href="#">Yad2</a>
          </li>
          <li>
            <a href="GiftFinder.html">Gift Finder</a>
          </li>
        </ul>
      </nav>
      <!-- End Navigation Bar -->
    </header>
    <main style="margin-top: 170px">
      <!-- Filter Sidebar -->

      <div class="filter-sidebar" id="filter-sidebar">
        <h2 class="filter-title">Filters</h2>

        <table class="filter-container">
          <tr>
            <td>
              <span class="select-label">Age</span>
            </td>
            <td>
              <select class="select-filter" id="age-filter">
                <option value="">All</option>
                <option value="0-12 months">0-12 months</option>
                <option value="12-24 months">12-24 months</option>
                <option value="2-4">2-4 Years</option>
                <option value="5-7">5-7 Years</option>
                <option value="8-99">8-99 Years</option>
              </select>
            </td>
          </tr>
          <tr>
            <td>
              <span class="select-label">Category</span>
            </td>
            <td>
              <select class="select-filter" id="game-type-filter">
                <option value="">All</option>
                <option value="board">Board Games</option>
                <option value="riding">Riding Toys</option>
                <option value="book">Books</option>
                <option value="sience">Sience</option>
                <option value="puzzle">Puzzle Games</option>
                <option value="Lego">Leggo</option>
                <option value="games">Games</option>
                <option value="music & karaoke">Music & Karaoke</option>
                <option value="dolls">Dolls</option>
                <option value="10$ & bellow">10$ & Bellow</option>
                <option value="Yad 2">Yad 2</option>
                <option value="sale">SALE</option>
              </select>
            </td>
          </tr>

          <tr>
            <td class="price-title">
              <span class="select-label">Price Range</span>
            </td>
            <td>
              <div class="price-container">
                <input
                  type="number"
                  id="min-price-input"
                  min="0"
                  value="0"
                  class="price-input center"
                /><span>-</span>

                <input
                  type="number"
                  id="max-price-input"
                  min="0"
                  class="price-input center"
                />
              </div>
            </td>
          </tr>
          <tr>
            <td>
              <span class="select-label">Sort By</span>
            </td>
            <td>
              <select class="select-filter" id="Sortby-filter">
                <option value="">Recommended</option>
                <option value="bestSelling">Best selling</option>
                <option value="highToLow">Price high to low</option>
                <option value="lowToHigh">Price low to high</option>
              </select>
            </td>
          </tr>
        </table>

        <button type="button" class="btn-ns-hot center" id="filter-button">
          Apply Filters
        </button>
      </div>

      <!-- Product Grid -->
      <div class="product-grid-section">
        <h1 class="category-title" id="category-title">BOARD GAMES</h1>
        <div class="sort-select">
          <label class="sort-select-label" for="sort">Sort By:</label>
          <select class="select-filter" id="Sortby-filter2">
            <option value="recommended">Recommended</option>
            <option value="bestSelling">Best selling</option>
            <option value="highToLow">Price high to low</option>
            <option value="lowToHigh">Price low to high</option>
          </select>          
        </div>
        
          <div
            class="product-item"
            data-age-range="0-12 months"
            data-game-type="board"
            data-price="100.00"
            filter-by=""
          >
            <a class="product-img" href="#">
              <img
                src="http://img1.exportersindia.com/product_images/bc-small/dir_55/1620613/cannondale-jekyll-1-2011-mountain-bike-309779.jpg"
                alt="item"
              />
            </a>
            <section class="product-title">
              <span class="product-title-desc"
                ><a href="#">Cannondale Jekyll 3 - Mountain</a></span
              >
            </section>
            <section class="product-price">
              <span class="product-title-price center"> $130</span>
            </section>
          </div>
        </div>
      </div>
      <div class="product-grid-section">
        <h1 class="category-title" id="category-title">BOARD GAMES</h1>
        <div class="sort-select">
          <label class="sort-select-label" for="sort">Sort By:</label>
          <select class="sort-select-filter" id="Sortbyfilter">
            <option value="recommended">Recommended</option>
            <option value="best-selling">Best Selling</option>
            <option value="highToLow">Price: High to Low</option>
            <option value="lowToHigh">Price: Low to High</option>
          </select>          
        </div>
        <div id="productGrid"></div>
      </div>
      <script>
        const productGrid = document.getElementById("productGrid");

        // Function to create the product HTML structure
        function createProductHTML(product) {
          const productContainer = document.createElement("div");
          productContainer.className = "product-container";

          const productTitleSection = document.createElement("section");
          productTitleSection.className = "product-title";
          const productTitleDesc = document.createElement("span");
          productTitleDesc.className = "product-title-desc";
          const productLink = document.createElement("a");
          productLink.href = "#";
          productLink.textContent = product.title;
          productTitleDesc.appendChild(productLink);
          productTitleSection.appendChild(productTitleDesc);

          const productPriceSection = document.createElement("section");
          productPriceSection.className = "product-price";
          const productTitlePrice = document.createElement("span");
          productTitlePrice.className = "product-title-price";
          productTitlePrice.textContent = `$${product.price}`;
          productPriceSection.appendChild(productTitlePrice);

          const productImageSection = document.createElement("section");
          productImageSection.className = "product-image";
          const productImage = document.createElement("img");
          productImage.src = product.image;
          productImage.alt = product.title;
          productImageSection.appendChild(productImage);

          productContainer.appendChild(productTitleSection);
          productContainer.appendChild(productPriceSection);
          productContainer.appendChild(productImageSection);

          return productContainer;
        }

        function fetchAndDisplayProducts() {
          const apiUrl = "http://127.0.0.1:8080/api/products";

          // Creating a new AJAX request
          const xhr = new XMLHttpRequest();
          xhr.open("GET", apiUrl, true);

          xhr.onload = function () {
            if (xhr.status === 200) {
              const products = JSON.parse(xhr.responseText);
              products.forEach((product) => {
                const productHTML = createProductHTML(product);
                productGrid.appendChild(productHTML);
              });
            } else {
              console.error("Error fetching products:", xhr.statusText);
            }
          };

          xhr.onerror = function () {
            console.error("Network error occurred");
          };

          // Sending the AJAX request
          xhr.send();
        }

        // Call the function to fetch and display products
        fetchAndDisplayProducts();

        // Function to apply filters and display filtered products
        function applyFilters(products) {
          const selectedCategory =
            document.getElementById("game-type-filter").value;
          const minPrice = parseFloat(
            document.getElementById("min-price-input").value
          );
          const maxPrice = parseFloat(
            document.getElementById("max-price-input").value
          );
          const selectedSorting =
            document.getElementById("Sortbyfilter").value;

          const filteredProducts = products.filter((product) => {
            const isCategoryMatch =
              selectedCategory === "" || product.category === selectedCategory;
            const isPriceInRange =
              (isNaN(minPrice) || product.price >= minPrice) &&
              (isNaN(maxPrice) || product.price <= maxPrice);

            return isCategoryMatch && isPriceInRange;
          });

          // Sort the filtered products based on selected sorting criteria
          sortProductsByPrice(filteredProducts, selectedSorting);

          // Clear the existing products and display the filtered ones
          productGrid.innerHTML = ""; // Clear existing products
          filteredProducts.forEach((product) => {
            const productHTML = createProductHTML(product);
            productGrid.appendChild(productHTML);
          });
        }
        function sortProductsByPrice(products, sortOrder) {
          products.sort((a, b) => {
            const priceDifference = a.price - b.price;
            return sortOrder === "highToLow"
              ? -priceDifference
              : priceDifference;
          });
        }

        // Fetch and display products
        function fetchAndDisplayProducts() {
          const apiUrl = "http://127.0.0.1:8080/api/products";

          // Creating a new AJAX request
          const xhr = new XMLHttpRequest();
          xhr.open("GET", apiUrl, true);

          xhr.onload = function () {
            if (xhr.status === 200) {
              const products = JSON.parse(xhr.responseText);
              applyFilters(products); // Apply filters to the fetched products
            } else {
              console.error("Error fetching products:", xhr.statusText);
            }
          };

          xhr.onerror = function () {
            console.error("Network error occurred");
          };

          // Sending the AJAX request
          xhr.send();
        }

        // Attach the filter button's click event handler for category filter
        const FilterButton = document.getElementById("filter-button");
        FilterButton.addEventListener("click", function () {
          fetchAndDisplayProducts(); // Fetch and display products when category filter button is clicked
        });

        const sortDropdown = $("#Sortbyfilter");
        sortDropdown.on("change", function() {
          fetchAndDisplayProducts(); // Fetch and display products when sorting option is changed
        });

        // Call the function initially to display products
        fetchAndDisplayProducts();
      </script>
    </main>
    <div id="myModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modal-content"></div>
      </div>
    </div>
  </body>
</html>
