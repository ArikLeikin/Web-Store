<!DOCTYPE html>
<html>
  <head>
    <title>Games For All</title>
    <link rel="icon" type="image/x-icon" href="../images/favicon.png" />
    <link rel="stylesheet" href="../css/index.css" />
    <link rel="stylesheet" type="text/css" href="../css/products.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.all.min.js"></script>
    <script src="../js/index.js"></script>
    <script src="../js/products.js"></script>
  </head>
  <body>
    <header class="header" role="banner">
      <div class="container">
        <nav class="navUser">
          <ul class="navUser-section">
            <li class="item__account" id="item__account">
              <a aria-label="Account" href="http://127.0.0.1:8080/login"
                ><img
                  src="../images/white-icons/account-icon.png"
                  alt="account"
                  width="30"
                />
              </a>
            </li>
            <li class="item__wishlist">
              <a aria-label="Wishlist" href="">
                <img
                  src="../images/white-icons/wishlist-icon.png"
                  alt="Cart"
                  width="30"
                />
              </a>
            </li>
            <li class="item__cart">
              <a href="http://127.0.0.1:8080/cart" aria-label="Cart">
                <img
                  src="../images/white-icons/cart-icon.png"
                  alt="Cart"
                  width="30"
                />
              </a>
            </li>
          </ul>
        </nav>

        <div class="header-logo">
          <a href="http://127.0.0.1:8080/" data-instantload='{"page":"home"}'>
            <div class="header-logo-image-container">
              <img
                class="header-logo-image"
                src="../images/logo.png"
                width="180"
                height="auto"
              />
            </div>
          </a>
        </div>

        <div class="quickSearch">
          <form class="form">
            <div class="form-container">
              <input
                class="form-input"
                data-search-quick
                name="search_query"
                id="search_query"
                data-error-message="Search field cannot be empty."
                placeholder="Search the store"
                autocomplete="off"
              />
              <button
                type="submit"
                class="button search-button"
                id="searchButton"
              >
                <img
                  src="../images/white-icons/search-icon.png"
                  alt="Search"
                  width="25"
                  height="auto"
                />
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Start Navigation Bar -->
      <nav class="navbar">
        <ul class="menu">
          <li>
            <a
              class="hasDropdown header-title"
              href="http://127.0.0.1:8080/products"
              >Categories <i class="fa fa-angle-down"></i
            ></a>

            <ul class="nav_container">
              <div class="container__list">
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?category=boardgames"
                      class="sub-label-menu"
                      >Board Games</a
                    >
                  </div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?category=science"
                      class="sub-label-menu"
                      >Science</a
                    >
                  </div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?category=games"
                      class="sub-label-menu"
                      >Games</a
                    >
                  </div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?category=ridingtoys"
                      class="sub-label-menu"
                      >Riding Toys</a
                    >
                  </div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?category=puzzles"
                      class="sub-label-menu"
                      >Puzzles</a
                    >
                  </div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?category=musickaroke"
                      class="sub-label-menu"
                      >Music & Karaoke</a
                    >
                  </div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?category=books"
                      class="sub-label-menu"
                      >Books</a
                    >
                  </div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?category=lego"
                      class="sub-label-menu"
                      >Lego</a
                    >
                  </div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?category=dolls"
                      class="sub-label-menu"
                      >Dolls</a
                    >
                  </div>
                </div>
                <div class="container__listItem"></div>
                <div class="container__listItem"></div>

                <div class="container__listItem">
                  <div class="container__listItem_title bold no-underline">
                    <a
                      href="http://127.0.0.1:8080/products?category=10andbellow"
                      class="sub-label-menu"
                      >$10 & Below</a
                    >
                  </div>
                </div>
              </div>
            </ul>
          </li>
          <li>
            <a class="hasDropdown header-title" href="#"
              >Ages<i class="fa fa-angle-down"></i
            ></a>
            <ul class="nav_container">
              <div class="container__list">
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?age=0-12"
                      class="sub-label-menu"
                      >0-12 MONTHS</a
                    >
                  </div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?age=12-24"
                      class="sub-label-menu"
                      >12-24 MONTHS</a
                    >
                  </div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?age=2-4"
                      class="sub-label-menu"
                      >2-4 YEARS</a
                    >
                  </div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?age=5-7"
                      class="sub-label-menu"
                      >5-7 YEARS</a
                    >
                  </div>
                </div>
                <div class="container__listItem">
                  <div class="container__listItem_title">
                    <a
                      href="http://127.0.0.1:8080/products?age=8-99"
                      class="sub-label-menu"
                      >8-99 YEARS</a
                    >
                  </div>
                </div>
              </div>
            </ul>
          </li>
          <li>
            <a
              href="http://127.0.0.1:8080/products?category=outdoor"
              class="header-title"
              >Outdoor</a
            >
          </li>
          <li>
            <a
              href="http://127.0.0.1:8080/products?category=yad2"
              class="header-title"
              >Yad2</a
            >
          </li>
          <li>
            <a href="http://127.0.0.1:8080/Gift-Finder" class="header-title"
              >Gift Finder</a
            >
          </li>
        </ul>
      </nav>
      <!-- End Navigation Bar -->
    </header>
    <main style="margin-top: 170px">
      <!-- Filter Sidebar -->

      <div class="filter-sidebar" id="filter-sidebar">
        <h2 class="filter-title">Filters</h2>

        <table class="filter-container">
          <tr>
            <td>
              <span class="select-label">Age</span>
            </td>
            <td>
              <select class="select-filter" id="age-filter">
                <option value="">All</option>
                <option value="0-12">0-12 months</option>
                <option value="12-24">12-24 months</option>
                <option value="2-4">2-4 Years</option>
                <option value="5-7">5-7 Years</option>
                <option value="8-99">8-99 Years</option>
              </select>
            </td>
          </tr>
          <tr>
            <td>
              <span class="select-label">Category</span>
            </td>
            <td>
              <select class="select-filter" id="game-type-filter">
                <option value="">All</option>
                <option value="boardgames">Board Games</option>
                <option value="ridingtoys">Riding Toys</option>
                <option value="books">Books</option>
                <option value="science">Science</option>
                <option value="puzzles">Puzzle Games</option>
                <option value="lego">Lego</option>
                <option value="games">Games</option>
                <option value="musickaroke">Music & Karaoke</option>
                <option value="dolls">Dolls</option>
                <option value="outdoor" hidden>Outdoor</option>
                <option value="yad2" hidden>Yad 2</option>
              </select>
            </td>
          </tr>

          <tr>
            <td class="price-title">
              <span class="select-label">Price Range</span>
            </td>
            <td>
              <div class="price-container">
                <input
                  type="number"
                  id="min-price-input"
                  min="0"
                  value="0"
                  class="price-input center"
                /><span>-</span>

                <input
                  type="number"
                  id="max-price-input"
                  min="0"
                  class="price-input center"
                />
              </div>
            </td>
          </tr>
        </table>

        <button type="button" class="btn-ns-hot center" id="filter-button">
          Apply Filters
        </button>
      </div>
      <!-- Product Grid -->
      <div class="product-grid-section">
        <h1 class="category-title" id="category-title">BOARD GAMES</h1>
        <div class="sort-select">
          <label class="sort-select-label" for="Sortbyfilter">Sort By:</label>
          <select class="sort-select-filter" id="Sortbyfilter">
            <option value="recommended">Recommended</option>
            <option value="best-selling">Best Selling</option>
            <option value="highToLow">Price: High to Low</option>
            <option value="lowToHigh">Price: Low to High</option>
          </select>
        </div>
        <div id="productGrid"></div>
      </div>

      <script>
        var max = 0;

        $(document).ready(function () {
          const productGrid = $("#productGrid");
          $("#category-title").text("All Games");
          // Function to create the product HTML structure
          function createProductHTML(product) {
            const productItem = document.createElement("div");
            productItem.className = "product-item";
            productItem.setAttribute("data-age-range", product.ageRange);
            productItem.setAttribute("data-game-type", product.gameType);
            productItem.setAttribute("data-price", product.price);
            productItem.setAttribute("filter-by", "");
            const productLink = document.createElement("a");
            productLink.className = "product-img";
            productLink.href = "/product-details?id=" + product._id;
            const productImage = document.createElement("img");
            productImage.src = product.image;
            productImage.alt = "item";
            productLink.appendChild(productImage);
            const productTitleSection = document.createElement("section");
            productTitleSection.className = "product-title";
            const productTitleDesc = document.createElement("span");
            productTitleDesc.className = "product-title-desc";
            const productTitleLink = document.createElement("a");
            productTitleLink.href = "#";
            productTitleLink.textContent = product.title;
            productTitleDesc.appendChild(productTitleLink);
            productTitleSection.appendChild(productTitleDesc);
            const productPriceSection = document.createElement("section");
            productPriceSection.className = "product-price";
            const productTitlePrice = document.createElement("span");
            productTitlePrice.className = "product-title-price center"; // Adding 'center' class
            productTitlePrice.textContent = `$${product.price}`;
            productPriceSection.appendChild(productTitlePrice);

            productItem.appendChild(productLink);
            productItem.appendChild(productTitleSection);
            productItem.appendChild(productPriceSection);
            if (max < product.price) {
              max = product.price;
            }
            updatemaxprices();
            return productItem;
          }

          // Add an event listener to the min input field
          $("#min-price-input").on("input", function () {
            var minValue = parseFloat($(this).val()) || 0;
            var currentMaxValue =
              parseFloat($("#max-price-input").val()) || initialMaxValue;

            // Update the max attribute of the max input field
            $("#max-price-input").attr(
              "min",
              currentMaxValue < minValue ? currentMaxValue : minValue
            );
          });

          // Add an event listener to the max input field
          $("#max-price-input").on("input", function () {
            var maxValue = parseFloat($(this).val()) || initialMaxValue;
            var currentMinValue = parseFloat($("#min-price-input").val()) || 0;

            // Update the max attribute of the min input field
            $("#min-price-input").attr(
              "max",
              maxValue > currentMinValue ? maxValue : currentMinValue
            );
          });

          function updatemaxprices() {
            $("#max-price-input").attr("max", max + 1);
            $("#max-price-input").val(parseInt(max + 1));
            $("#min-price-input").attr(
              "max",
              parseInt($("#max-price-input").val()) - 1
            );
          }

          $("#min-price-input, #max-price-input").on(
            "keydown",
            function (event) {
              if (
                event.keyCode !== 38 &&
                event.keyCode !== 40 &&
                event.keyCode !== 13
              ) {
                event.preventDefault();
              }
            }
          );

          function applyFilters(products) {
            const selectedGameType = $("#game-type-filter").val();
            const minPrice = parseFloat($("#min-price-input").val());
            const maxPrice = parseFloat($("#max-price-input").val());
            const selectedSorting = $("#Sortbyfilter").val();

            if (minPrice > maxPrice) {
            }

            const filteredProducts = products.filter((product) => {
              const filterCategory =
                urlCategory !== null ? urlCategory : selectedGameType;
              const isGameTypeMatch =
                !filterCategory ||
                product.category.toLowerCase() === filterCategory.toLowerCase();
              const isPriceInRange =
                (!minPrice || product.price >= minPrice) &&
                (!maxPrice || product.price <= maxPrice);
              return isGameTypeMatch && isPriceInRange;
            });

            sortProductsByPrice(filteredProducts, selectedSorting);

            productGrid.empty();
            filteredProducts.forEach((product) => {
              const productHTML = createProductHTML(product);
              productGrid.append(productHTML);
            });
          }

          function sortProductsByPrice(products, sortOrder) {
            products.sort((a, b) => {
              const priceDifference = a.price - b.price;
              return sortOrder === "highToLow"
                ? -priceDifference
                : priceDifference;
            });
          }

          function fetchAndDisplayProducts() {
            const apiUrl = "http://127.0.0.1:8080/api/products";

            $.get(apiUrl, function (data, status) {
              if (status === "success") {
                applyFilters(data);
              } else {
                console.error("Error fetching products:", status);
              }
            }).fail(function () {
              console.error("Network error occurred");
            });
          }

          // Function to extract URL parameters
          function getUrlParameter(name) {
            const results = new RegExp("[\?&]" + name + "=([^&#]*)").exec(
              window.location.href
            );
            if (results == null) {
              return null;
            } else {
              return decodeURI(results[1]) || 0;
            }
          }

          // Extract 'category' parameter from the URL
          const urlCategory = getUrlParameter("category");
          if (urlCategory) {
            const optionValues = [
              { value: "", label: "All" },
              { value: "boardgames", label: "Board Games" },
              { value: "ridingtoys", label: "Riding Toys" },
              { value: "books", label: "Books" },
              { value: "science", label: "Sience" },
              { value: "puzzles", label: "Puzzle Games" },
              { value: "lego", label: "Lego" },
              { value: "games", label: "Games" },
              { value: "musickaroke", label: "Music & Karaoke" },
              { value: "dolls", label: "Dolls" },
              { value: "outdoor", label: "Outdoor" },
              { value: "yad2", label: "Yad 2" },

              // { value: "10andbellow", label: "10$ & Bellow" },
              // { value: "sale", label: "SALE" }
            ];
            const selectedOption = optionValues.find(
              (option) =>
                option.value.toLowerCase() === urlCategory.toLowerCase()
            );

            $("#game-type-filter").val(selectedOption.value);
            // $("#game-type-filter").prop("disabled", true);
            $("#category-title").text(selectedOption.label);

            fetchAndDisplayProducts();
          }

          // Extract 'category' parameter from the URL
          const urlAge = getUrlParameter("age");
          if (urlAge) {
            const optionValues = [
              { value: "", label: "All" },
              { value: "0-12", label: "0-12 months" },
              { value: "12-24", label: "12-24 months" },
              { value: "2-4", label: "2-4 Years" },
              { value: "5-7", label: "5-7 Years" },
              { value: "8-99", label: "8-99 Years" },
            ];
            const selectedOption = optionValues.find(
              (option) => option.value.toLowerCase() === urlAge.toLowerCase()
            );

            $("#age-filter").val(selectedOption.value);
            // $("#age-filter").prop("disabled", true);

            fetchAndDisplayProducts();
          }

          $("#filter-button").click(function () {
            fetchAndDisplayProducts();
          });

          $("#Sortbyfilter").change(function () {
            fetchAndDisplayProducts();
          });

          fetchAndDisplayProducts(); // Initial fetch and display
        });
      </script>
    </main>
    <div id="myModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modal-content"></div>
      </div>
    </div>
  </body>

  <html></html>
</html>
